# Никита Бирюлин - "FindLyco"
# Пользовательские сценарии

### Группа: 10 - МИ - 3
### Электронная почта: keddad@yandex.ru
### VK: www.vk.com/lix0rte


### [ Сценарий 1 - Получение информации о пользователе на картинке через бота ]
1. Пользователь фотографирует человека, информацию о котором он хочет получить
2. Пользователь запускает приложение телеграмм и переходит к боту
3. Пользователь нажимает на кнопку "Отправить фото"
4. Пользователь отправляет картинку боту
5. Если на фотографии не было найдено лицо, пользователю предлагается отправить фото повторно
6. Пользователь получает сообщение о необходимости ожидания и количестве задач в очереди перед ним
7. Если фото с таким лицом не было найдено в базе данных, пользователю отправляется соответсвующая ошибка
8. Если в базе данных было успешно найдено фото, пользователь получает карточки самых похожих людей, содержащие ФИО и ссылку на страницу в социальной сети

### [ Сценарий 2 - Получение информации о пользователях на видео через бота ]
1. Пользователь фотографирует человека, информацию о котором он хочет получить
2. Пользователь запускает приложение телеграмм и переходит к боту
3. Пользователь нажимает на кнопку "Отправить видео"
4. Пользователь отправляет видео боту
5. Если на видео не были найдены лица, пользователю предлагается отправить видео повторно
6. Пользователь получает сообщение о необходимости ожидания и количестве задач в очереди перед ним. Далее для каждого уникального лица на видео:
7. Если лица нет в базе данных, отправляется соответсвующее предупреждение
8. Если в базе данных было успешно найдено фото, пользователь получает карточки самых похожих людей, содержащие ФИО и ссылку на страницу в социальной сети

### [ Сценарий 3 - Получение информации о пользователях на фото через сайт ]
1. Пользователь переходит на сайт, предположительно, keddad.wtf
2. Пользователь перетаскивает фото на соответствующее окошко/нажимает кнопку "выбрать" с дальнейшим всплывающим окном выбора
3. Если файл неверного формата или слишком большого размера, пользователь получает ошибку и не может загрузить файл
4. Пользователь нажимает кнопку "отправить"
5. Если сервер счел изображение некорректным (заявленный формат не соответствует содержимому файла), пользователь получает ошибку
6. Если все хорошо, пользователь получает уникальную ссылку, которая ведет на страницу поиска.
7. Пользователь переходит по ссылке. Если запрос еще обрабатывается, пользователь увидит соответсвующую надпись. Если при выполнении произошла ошибка, он увидит сооветствующую надпись
8. Если запрос был выполнен успешно, пользователь получит страницу с результатами поиска. После первого открытия ссылка протухает для защиты приватности пользователей (и размера кеша Редиса, как выяснилось после начала разработки)

### [ Сценарий 4 - Получение информации о пользователях на видео через сайт ]

1. Пользователь переходит на сайт, предположительно, keddad.wtf
2. Пользователь перетаскивает видео на соответствующее окошко/нажимает кнопку "выбрать" с дальнейшим всплывающим окном выбора
3. Если файл неверного формата или слишком большого размера, пользователь получает ошибку и не может загрузить файл
4. Пользователь нажимает кнопку "отправить"
5. Если сервер счел изображение некорректным (заявленный формат не соответствует содержимому файла), пользователь получает ошибку
6. Если все хорошо, пользователь получает уникальные ссылки, по одной ссылке для каждого уникального лица на видео. Далее для каждой ссылки:
7. Пользователь переходит по ссылке. Если запрос еще обрабатывается, пользователь увидит соответсвующую надпись. Если при выполнении произошла ошибка, он увидит сооветствующую надпись
8. Если запрос был выполнен успешно, пользователь получит страницу с результатами поиска. После первого открытия ссылка протухает для защиты приватности пользователей (и размера кеша Редиса, как выяснилось после начала разработки)

### [ Сценарий 5 - Получение информации о пользователях на видео на стороннем источнике через сайт ]
1. Пользователь переходит на сайт, предположительно, keddad.wtf
2. Пользователь кликает на кнопку "Видео по ссылке"
3. Доступность и наличие видео по ссылке проверяется
4. Пользователь нажимает кнопку "отправить"
5. Если сервер счел изображение некорректным (заявленный формат не соответствует содержимому файла), пользователь получает ошибку
6. Если все хорошо, пользователь получает уникальные ссылки, по одной ссылке для каждого уникального лица на видео. Далее для каждой ссылки:
7. Пользователь переходит по ссылке. Если запрос еще обрабатывается, пользователь увидит соответсвующую надпись. Если при выполнении произошла ошибка, он увидит сооветствующую надпись
8. Если запрос был выполнен успешно, пользователь получит страницу с результатами поиска. После первого открытия ссылка протухает для защиты приватности пользователей (и размера кеша Редиса, как выяснилось после начала разработки)

### [ Сценарий 6 - Получение информации о пользователях на фото через API ]
1. Сторонний разработчик получает ключ API
2. Сторонний разработчик выполняет запрос на keddad.wtf/api/tasks/findface, передавая в JSON payload параметром face  Base85 от файла картинки
3. Если картинка неверна, разработчик получает ошибку HTTP 400
4. Если сервер не может выполнить запрос (Очередь заполнена другими задачами от более приоритетных источников, таких как бот или сайт), возвращается HTTP 503
5. Если все хорошо, сервер возвращает строчку текста с ID задачи
6. Когда разработчику нужен результат распознования, он делает запрос вида keddad.wtf/api/tasks/findface/@ID@
7. Если задача еще в очереди, разработчик получит ответ "PENDING"
8. Если задача завершенна с ошибкой, разработчик получит ответ "ERROR ОПИСАНИЕОШИБКИ"
9. Если все хорошо, разработчик получит JSON. Сложная структура JSONа описана в документации.

### [ Сценарий 7 - Получение информации о пользователях на видео через API ]
1. Сторонний разработчик получает ключ API
2. Сторонний разработчик обрабатывает видео каскадами Хаара, находя уникальные лица
3. Для каждой из картинок, разработчик делает запрос, описанный в 6.2 (Сценарий 6, часть 2)
4. Для каждой из картинок, если произошла ошибка, разработчику следует повторно отправлять только те картинки, которые вернули ошибку при отправке изначального запроса
5. Для каждой из картинок, если картинка вернула ошибку при обработке, отправлять картинку снова не требуется
6. Для каждой из картинок, если картинка обрабатывается, то обрабатываются и все последующие, повторных запросов отправлять не требуется
7. Для каждой из картинок, если картинка выполнена и отправлен ее результат как в 6.9, все картинки отправленные до нее тоже готовы и следует проверить их статус.